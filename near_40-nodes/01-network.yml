---
# 1. Network
# Define the network properties
#
# Concepts:
# --------
# Network: The "network" variable has different network instances (net-1, net-2, etc.)
#   as subelements. Every instance is split into two main parts:
#  1 Flows: The network topology is entirely defined through the flows.
#      Only nodes and interfaces that occur in a flow are part of the topology!
#      It is recommended to add node-to-node flows to build the basic topology and
#      on top of that add "long-distance" or more complex flows that are later used
#      by services/applications.
#  2 TSN: Map TSN configurations to nodes and interfaces
#
# TSNConfigs: The "tsnconfigs" variable contains the full tsn configurations
#   that are referenced in the network instances.
#

# ------------------------------ FLOWS + T  SN-map -------------------------------
network:
# Dogecoin
  net-1:
    qdisc: {}
    iconfig: {}
      # tsn-3: ["node-1:1.3"]
    #OvS flows aim to offer L2 forwarding wit L3 functionality on the source and sink.
    #Physical and SR-IOV Setups target to connect devices based on IPs. However, there is no (currently) L3 routing. Therefore, the connection can be only via one hop. For that can be used the new format as "subnet-XX;:node-X:iface,iface:node-X:". The way how IPs are computed ensures they are unique and ping works on them.
    # Requires network_config: Physical/SR-IOV in group_vars/all.yml
    # Below config for Physical setup:
    flows:
      1: 'subnet-20;:node-2:1,1:node-1:'
      2: 'subnet-20;:node-3:1,1:node-1:'
      3: 'subnet-20;:node-4:1,1:node-1:'
      4: 'subnet-20;:node-5:1,1:node-1:'
      5: 'subnet-20;:node-6:1,1:node-1:'
      6: 'subnet-20;:node-7:1,1:node-1:'
      7: 'subnet-20;:node-8:1,1:node-1:'
      8: 'subnet-20;:node-9:1,1:node-1:'
      9: 'subnet-20;:node-10:1,1:node-1:'
      10: 'subnet-20;:node-11:1,1:node-1:'
      11: 'subnet-20;:node-12:1,1:node-1:'
      12: 'subnet-20;:node-13:1,1:node-1:'
      13: 'subnet-20;:node-14:1,1:node-1:'
      14: 'subnet-20;:node-15:1,1:node-1:'
      #Additional flows
      15: 'subnet-20;:node-5:1,1:node-6:'
      16: 'subnet-20;:node-10:1,1:node-11:'
      17: 'subnet-20;:node-15:1,1:node-6:'
      18: 'subnet-20;:node-15:1,1:node-11:'
      19: 'subnet-20;:node-6:1,1:node-10:'
      20: 'subnet-20;:node-2:1,1:node-5:'
      21: 'subnet-20;:node-4:1,1:node-2:'
      22: 'subnet-20;:node-9:1,1:node-7:'
      23: 'subnet-20;:node-14:1,1:node-12:'
      24: 'subnet-20;:node-3:1,1:node-8:'
      #PTP flows
      #  algofi - goracle
      25: 'subnet-21;:node-16:3,4:node-17:'
      # algofi -  zone
      26: 'subnet-22;:node-16:2,2:node-18:'


    check: true
    num_net_cores: 0 # Specify the number of cores assigned to NIC IRQs. Cores beginning with core 0 will be allocated to the IRQs. E.g. if specified to 2 means that IRQs will be allocated to cores 0 and 1
    nic_irq_rt: false # Specify if the NIC IRQs will be set to real-time priority in the linux kernel
# Litecoin:
  net-2:
    qdisc: {}
    iconfig: {}
    flows:
      1: 'subnet-1;:node-1:1,1:node-2:'
      2: 'subnet-2;:node-2:3,3:node-3:'
      3: 'subnet-3;:node-1:3,2:node-3:'

    check: true
    num_net_cores: 0 # Specify the number of cores assigned to NIC IRQs. Cores beginning with core 0 will be allocated to the IRQs. E.g. if specified to 2 means that IRQs will be allocated to cores 0 and 1
    nic_irq_rt: false # Specify if the NIC IRQs will be set to real-time priority in the linux kernel
# Ether:
  net-3:
    qdisc: {}
    iconfig: {}
    flows:
      1: 'subnet-1;:node-1:4,4:node-2:'
      2: 'subnet-1;:node-2:4,4:node-3:'
      3: 'subnet-1;:node-1:4,4:node-3:'
      # PTP flows
      # 4: 'subnet-2;:node-1:3,2:node-3:' # Dogecoin <-> Dogecoincash
      # 5: 'subnet-3;:node-1:7,7:node-2:' # Dogecoin <-> Dogecoincash
      # 6: 'subnet-4;:node-1:6,6:node-3:' # Dogecoin <-> Dogecoingold
      # 7: 'subnet-5;:node-2:1,1:node-3:' # Dogecoincash <-> Dogecoingold
      # 8: 'subnet-6;:node-2:6,6:node-3:' # Dogecoincash <-> Dogecoingold

    # bitcoin, cash, gold
      # 1: 'subnet-1;:node-1:4,4:node-3:'
      # 2: 'subnet-1;:node-2:4,4:node-3:'
      # 3: 'subnet-1;:node-1:4,4:node-2:'
    check: true
    num_net_cores: 0 # Specify the number of cores assigned to NIC IRQs. Cores beginning with core 0 will be allocated to the IRQs. E.g. if specified to 2 means that IRQs will be allocated to cores 0 and 1
    nic_irq_rt: false # Specify if the NIC IRQs will be set to real-time priority in the linux kernel
# Bitcoin + Ether
  net-4:
    qdisc: {}
    iconfig: {}
    flows:
      1: 'subnet-30;:node-2:1,1:node-1:'
      2: 'subnet-30;:node-3:1,1:node-1:'
      3: 'subnet-30;:node-4:1,1:node-1:'
      4: 'subnet-30;:node-5:1,1:node-1:'
      5: 'subnet-30;:node-6:1,1:node-1:'
      6: 'subnet-30;:node-7:1,1:node-1:'
      7: 'subnet-30;:node-8:1,1:node-1:'
      8: 'subnet-30;:node-9:1,1:node-1:'
      9: 'subnet-30;:node-10:1,1:node-1:'
      10: 'subnet-30;:node-11:1,1:node-1:'
      11: 'subnet-30;:node-12:1,1:node-1:'
      12: 'subnet-30;:node-13:1,1:node-1:'
      13: 'subnet-30;:node-14:1,1:node-1:'
      14: 'subnet-30;:node-15:1,1:node-1:'
      15: 'subnet-30;:node-16:1,1:node-1:'
      16: 'subnet-30;:node-17:1,1:node-1:'
      17: 'subnet-30;:node-18:1,1:node-1:'
      18: 'subnet-30;:node-19:1,1:node-1:'
      19: 'subnet-30;:node-20:1,1:node-1:'
      20: 'subnet-30;:node-21:1,1:node-1:'
      21: 'subnet-30;:node-22:1,1:node-1:'
      22: 'subnet-30;:node-23:1,1:node-1:'
      23: 'subnet-30;:node-24:1,1:node-1:'
      24: 'subnet-30;:node-25:1,1:node-1:'
      25: 'subnet-30;:node-26:1,1:node-1:'
      26: 'subnet-30;:node-27:1,1:node-1:'
      27: 'subnet-30;:node-28:1,1:node-1:'
      28: 'subnet-30;:node-29:1,1:node-1:'
      29: 'subnet-30;:node-30:1,1:node-1:'
      30: 'subnet-30;:node-31:1,1:node-1:'
      31: 'subnet-30;:node-32:1,1:node-1:'
      32: 'subnet-30;:node-33:1,1:node-1:'
      33: 'subnet-30;:node-34:1,1:node-1:'
      34: 'subnet-30;:node-35:1,1:node-1:'
      35: 'subnet-30;:node-36:1,1:node-1:'
      36: 'subnet-30;:node-37:1,1:node-1:'
      37: 'subnet-30;:node-38:1,1:node-1:'
      38: 'subnet-30;:node-39:1,1:node-1:'
      39: 'subnet-30;:node-40:1,1:node-1:'
      # Additional flows
      40: 'subnet-30;:node-8:1,1:node-9:'
      41: 'subnet-30;:node-10:1,1:node-15:'
      42: 'subnet-30;:node-16:1,1:node-17:'
      43: 'subnet-30;:node-18:1,1:node-23:'
      44: 'subnet-30;:node-24:1,1:node-25:'
      45: 'subnet-30;:node-26:1,1:node-31:'
      46: 'subnet-30;:node-32:1,1:node-33:'
      47: 'subnet-30;:node-34:1,1:node-39:'
      # PTP flows
      #  algofi - goracle
      48: 'subnet-31;:node-41:3,4:node-42:'
      # algofi -  zone
      49: 'subnet-32;:node-41:2,2:node-43:'
      # algofi -  octorand
      50: 'subnet-33;:node-41:10,6:node-44:'
      # algofi - flare
      51: 'subnet-34;:node-41:9,6:node-45:'
    check: true
    num_net_cores: 0 # Specify the number of cores assigned to NIC IRQs. Cores beginning with core 0 will be allocated to the IRQs. E.g. if specified to 2 means that IRQs will be allocated to cores 0 and 1
    nic_irq_rt: false # Specify if the NIC IRQs will be set to real-time priority in the linux kernel
# ------------------------------ TSN configs -----------------------------------
# NOTE:
# - number of queue items is fixed depending on the number of hardware queues (Intel i210 = 4)
# - available priorities for the prio list go from 0 to 15
# - all priorities need to be assigned to the queues, use '*' in one queue for remaining priorities
# Use queue 0 in a taprio sched entry for a guard band
# ETF offload can only be set for queue 1 or 2, limitation of the intel i210 network card
# ETF queues together with taprio must be used with txtime enabled or only special (timestamped) traffic works
#
# IMPORTANT:
# ! Queue priorities MUST not overlap
# ! Map all 16 priorities to queues or use '*' in one of the queues
# ! All taprio Schedule durations MUST sum up to a factor of 1ms
# ! The maximum number of schedule entries is 13
#
# Every queues entry creates a queue with the defined behavior.
# The prio parameter defines what priorities should be processed by this queue.
# Always define at least one queue, the minimum default queue can look like this:
# {mode: be, prio: ['*']}
# These are the main queue modes, optional parameters are in brackets:
# 1. Best-Effort - use the default FIFO (first-in-first-out) queuing
# { mode: be, prio: [0,1,'*'] }
# 2. Credit-Based-Shaping - use the TSN credit shaper to queue packets (802.1Qav)
#   the idle/send/high/low parameters must be set according to the av standard
#   Offload uses the Qav feature of supported network cards, this can only be
#   used in queues 1 + 2 for the Intel i210.
# { mode: cbs, prio: [2,3], idle: '0', send: '0', high: '0', low: '0', (offload: true) }
# 3. Earliest Time First - queue the packets based on their launch timestamp.
#   Offload uses the Launch-Time Feature of supported network cards, this can only
#   be used in queue 1 + 2 for the Intel i210.
#   The default mode is strict, where packets are sent on their launch timestamp
#   with "deadline: yes" this is changed to deadline_mode where packets are sent
#   latest at their launch timestamp
# { mode: etf, prio: [4], (delta: 150000), (offload: true), (deadline: yes) }
#
# Taprio, which is the Time-aware priority scheduler 802.1Qbv, is configured
# in addition to the queues.

# TODO change schedule queue entries to a list instead of value
#        - { queue: 0, duration: 100 }
#        - { queue: [0,1], duration: 200 }
# TODO special-case txtime-assist is activated - multiple traffic classes map to
#  a single hw queue - change taprio schedules
#  the maximum number of traffic classes is still 8 even when multiple tcs can be
#  mapped to the same hw queue.

# Holds all TSN configurations
qdiscconfigs: {}
ifaceconfings: {}